# 冗余物理专线接入 {#concept_twb_lj1_ydb .concept}

您可以通过冗余物理专线将您的本地数据中心接入到阿里云，在您的本地数据中心和阿里云上的VPC间建立高质量、高可靠的内网通信。阿里云目前支持最多4条物理专线实现等价多路径路由（ECMP）。

## 应用场景 {#section_rjj_4j1_ydb .section}

本操作以如下场景介绍本地数据中心如何通过冗余物理专线接入阿里云上的VPC：

一家公司在北京拥有一个物理数据中心（私网网段：172.16.0.0/12），在阿里云“华东 1 \(杭州\)”地域中有一个专有网络（网段：192.168.0.0/16）。该公司为了解决单点故障问题，计划分别向两个运营商各申请一条专线，连接北京的物理数据中心和北京的阿里云接入点。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13851/15371639413977_zh-CN.png)

## 步骤一 申请第一条物理专线 {#section_phg_tj1_ydb .section}

完成以下操作，申请第一条物理专线：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧的导航栏，单击**物理专线连接** \> **物理专线**。
3.  单击**申请专线接入**。您可以直接联系阿里云合作伙伴，阿里云合作伙伴将会为您提供一站式服，也可以选择自助申请，本操作以自助申请为例。
4.  配置第一条专线。本操作中以如下配置为例，关于具体配置说明，参见[申请专线接入](intl.zh-CN/用户指南/物理专线/申请专线接入.md#)。
    -   **专线名称**：根据您的需要为物理专线设置名称，本操作中以“北京本地专线1”为例。
    -   **接入点**：选择最靠近本地机房的接入点，本操作中选择**华北2** \> **北京-大兴-A**。
    -   **使用运营商**：选择为您提供物理专线的运营商，本操作中选择**中国其他**。
    -   **接入端口类型**：选择物理专线的接入端口，本操作中选择**10GBase-LR-万兆单模光口（10千米）**。
    -   **接入带宽**：根据您的业务需要输入物理专线的接入带宽，单位为Mbps，本操作中输入**100**。
    -   **专线对端地址**：输入您的的本地数据中心所在的地址，例如“北京市xx区xx大街xx号”。
    -   **冗余物理专线**：由于是第一条物理专线，此处不需要选择。
5.  单击**确认申请**。在物理专线列表页，该专线状态为**申请中**。

    阿里云审核人员会对您的接入申请进行审核。一般情况下，第二个工作日就会完成审批。专线接入审批通过的标志是专线状态变为**审批通过**，此时您可以继续进行接入步骤。

6.  审批通过后，单击**支付接入费**，完成支付。支付成功后，系统会自动为您分配端口和物理专线ID。假设，当前此专线获得的物理专线ID为“pc-123xyz”。

## 步骤二 申请第二条物理专线 {#section_k3m_lhj_p2b .section}

完成以下操作，申请第二条物理专线：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧的导航栏，单击**物理专线连接** \> **物理专线**。
3.  单击**申请专线接入**。您可以直接联系阿里云合作伙伴，阿里云合作伙伴将会为您提供一站式服，也可以选择自助申请，本操作以自助申请为例。
4.  配置第一条专线。本操作中以如下配置为例，关于具体配置说明，参见[申请专线接入](intl.zh-CN/用户指南/物理专线/申请专线接入.md#)。
    -   **专线名称**：根据您的需要为物理专线设置名称，本操作中以“北京本地专线2”为例。
    -   **接入点**：选择最靠近本地机房的接入点，本操作中选择**华北2** \> **北京-大兴-A**。
    -   **使用运营商**：选择为您提供物理专线的运营商，本操作中选择**中国其他**。
    -   **接入端口类型**：选择物理专线的接入端口，本操作中选择**10GBase-LR-万兆单模光口（10千米）**。
    -   **接入带宽**：根据您的业务需要输入物理专线的接入带宽，单位为Mbps，本操作中输入**100**。
    -   **专线对端地址**：输入您的的本地数据中心所在的地址，例如“北京市xx区xx大街xx号”。
    -   **冗余物理专线**：选择冗余物理专线的ID。

        **说明：** 第二条冗余的线路可以选择同区域下的任何一个接入点，如果选择和第一条物理专线相同接入点时，请选择第一条专线的专线ID作为冗余物理专线（确保第一条专线的初装费已支付）；如果选择的接入点与第一条物理专线不同时，两条线路天然冗余，则不选**冗余物理专线**。

5.  接下来与第一条线路一样，完成申请与等待审批，审批后支付即可获得端口位置。

## 步骤三 完成专线施工 {#section_ckt_2l1_ydb .section}

完成以下操作，完成两条物理专线的施工：

1.  当系统完成端口分配，两条专线的状态变为**接入施工中**，单击右侧的**查看**，即可看到专线施工的相关信息，例如机房位置、机柜位置和端口信息等。
2.  将两条专线的端口信息告知您的运营商，并请运营商开始连接线缆。当运营商勘查完成资源后，会为您提供一份前往阿里接入点机房的人员名单及相关信息、前往阿里云机房的时间和物理专线专线ID。此时您需要向阿里云提交工单，告知阿里云售后人员运营商施工人员布线的信息。

    阿里云售后人员会在第二个工作日为您的运营商完成入室预约。并把当天机房接待人员的联系方式给您。将信息告知运营商。运营商在阿里侧机房接入施工完毕后，阿里云售后会把专线状态变为**等待确认**。

3.  运营商告知您专线已竣工后，单击**确认**。专线状态变为**正常**，表示完成专线接入。

## 步骤四 为物理专线创建边界路由器 {#section_rkf_pl1_ydb .section}

完成以下操作，为两条物理专线创建边界路由器：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**物理专线连接** \> **边界路由器**。
3.  单击**新建边界路由器**。
4.  本操作以如下配置为例，为第一条物理专线创建边界路由器，关于具体配置说明，参见[新建边界路由器](intl.zh-CN/用户指南/边界路由器/创建边界路由器.md#)。

    边界路由器 1：

    -   **创建对象**：选择**为本账户创建**。
    -   **名称**：输入边界路由器的名称，本操作中以边界路由器1”为例。
    -   **描述**：输入边界路由器的描述信息，本操作中以“物理专线1”为例。
    -   **物理专线**：选择第一条物理专线，本操作中选择**pc-123xyz**。
    -   **VLAN ID**：设置VLAN ID为0，表示直接使用三层路由接口。
    -   **电路编码**：输入运营商为您提供的电路编码。
    -   **互联地址**：根据以下信息设置物理专线两端的IP地址和子网掩码。

        **阿里云侧**：VPC到本地数据中心的路由网关，本操作中输入10.100.0.1。

        **客户侧**：本地数据中心到VPC的路由网关，本操作中输入10.100.0.10。

        **子网掩码**：阿里云侧和客户侧IP地址的子网掩码，本操作中输入255.255.255.0。

5.  重复以上操作，为第二条物理专线创建边界路由器，本操作中以“边界路由器2”表示。

## 步骤五 创建路由器接口 {#section_mcm_tm1_ydb .section}

在冗余物理专线的接入过程中，需要在两个边界路由器与VPC间上各创建一对路由器接口，使VPC和边界路由器可以通过路由器接口向对方转发消息。完成以下操作，创建路由器接口：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏， 单击**专有网络连接** \> **路由器接口**。
3.  单击**创建路由器接口**。
4.  参考如下配置为“边界路由器1”与VPC间创建路由器接口，具体配置说明，参见[创建路由器接口](intl.zh-CN/用户指南/路由器接口/创建路由器接口.md#)。
    -   **计费方式**：选择一种计费方式，本操作中选择**后付费**。
    -   **连接场景**：选择**专线接入**。
    -   **创建路由器接口场景**：选择**同时创建两端**。系统会将选择边界路由器做为连接发起端，并自动连接接受端。
    -   **地域**：选择物理专线接入点所在的地域，本操作中选择**华北2（北京）**。
    -   **接入点**：选择物理专线的接入点，本操作中为**北京-大兴-A**。
    -   **本端VBR ID**：选择“边界路由器1”。
    -   **对端地域**：选择您的VPC所在的地域，本操作中选择**华东1（杭州）**。
    -   **对端VPC ID**：选择您的VPC。

路由器接口创建成功后，系统会为VPC路由器和“边界路由器1”各创建一个路由器接口，并激活连接。

重复以上操作，为“边界路由器2”和VPC路由器间各创建一个路由器接口。

## 步骤六 配置健康检查IP地址 {#section_tfq_nn1_ydb .section}

冗余物理专线的健康检查的策略为：阿里云每两秒从每个健康检查源IP地址向本地数据中心中的健康检查目的地址发送一个ping报文，如果某条物理专线上连续八个ping报文都无法得到回复，则将流量切换至另一条链路。完成以下操作，在VPC中的路由器接口中配置健康检查源IP地址。

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏， 单击**专有网络连接** \> **路由器接口**。
3.  找到在步骤四中创建的VPC内的路由器接口，在其**操作**列下单击**更多** \> **健康检查**。
4.  单击**设置**，在弹出的对话框中配置以下信息，然后单击**确定**。
    -   **SourceIp**：选择VPC内的空闲IP地址作为健康检查的源IP地址。
    -   **TargetIp**：输入健康检查的目的IP地址，建议您选择本地数据中心中网络设备的接口IP地址作为健康检查的目的IP地址。
5.  重复以上操作，为另一个路由器接口配置健康检查IP地址。

    **说明：** 在多VPC场景下，每个连接物理冗余专线的VPC中的路由器接口都需要配置健康检查IP地址，以保证物理专线冗余机制顺利运行。


## 步骤七 配置路由 {#section_zmk_f41_ydb .section}

创建路由器接口后，需要为VPC的路由器接口配置到本地数据中心的路由，并为两个VBR的路由器接口配置指向VPC和物理专线的路由。最后需要为本地数据中心的接入设备添加指向VPC的路由，完成本地数据中心和VPC的互连。

配置VPC上的路由

完成以下操作，将VPC访问本地数据中心（网段：172.16.0.0/12）的流量转发至VBR：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  选择VPC所在的地域。
3.  在路由器接口的**操作**列下单击**路由配置**，在VPC路由器的详情页中单击**添加路由**。
4.  根据以下信息配置路由条目。具体配置说明，参见[添加路由](intl.zh-CN/用户指南/边界路由器/添加路由.md#)。
    -   **目标网段**：本地数据中心的网段。在本操作中为172.16.0.0/12。
    -   **下一跳类型**：选择**路由器接口**。
    -   **路由类型**：选择**等价路由**。
    -   **路由器接口**：选择数据包的出口，即步骤四中创建的VPC上的两个路由器接口。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/13851/15371639413985_zh-CN.png)

5.  单击**确定**。

配置VBR上的路由

添加指向物理专线的路由

完成以下操作，将VBR侧访问本地数据中心（网段：172.16.0.0/12）的流量转发至物理专线：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**物理专线连接** \> **边界路由器**。
3.  选择VBR所在的地域。
4.  在“边界路由器1”的**操作**列下单击**管理**，进入边界路由器详情页。单击**添加路由**。
5.  根据以下信息配置路由条目。具体配置说明，参见[添加路由](intl.zh-CN/用户指南/边界路由器/添加路由.md#)。
    -   **目标网段**：本地数据中心的网段。在本操作中为172.16.0.0/12。
    -   **下一跳方向**：选择**指向专线方向**。
    -   **下一跳**：选择在步骤四中创建的指向本地数据中心的路由器接口。
6.  单击**确定**，完成配置。完成后可以从本地数据中心访问阿里云侧互联地址10.100.0.1。

添加指向VPC的路由

完成以下操作，将VBR上访问 VPC（网段：192.168.0.0/16）的流量转发至VPC：

1.  登录[高速通道管理控制台](https://vpc.console.aliyun.com/expressConnect#/connection/cn-hangzhou/list)。
2.  在左侧导航栏，单击**物理专线连接** \> **边界路由器**。
3.  选择VBR所在的地域。
4.  在“边界路由器1”的**操作**列下单击**管理**，进入边界路由器详情页。单击**添加路由**。
5.  根据以下信息配置路由条目。具体配置说明，参见[添加路由](intl.zh-CN/用户指南/边界路由器/添加路由.md#)。
    -   **目标网段**：VPC的网段。在本操作中为192.168.0.0/16。
    -   **下一跳方向**：选择**指向VPC方向**。
    -   **下一跳**：选择在步骤四中创建的指向VPC的路由器接口。

重复以上操作，为“边界路由器2”配置指向VPC和本地数据中心的路由。

配置本地数据中心上的路由

至此，已完成阿里云上的路由配置。您还需要在专线接入设备上配置指向VPC内网段的路由。您可以选择配置静态路由或配置BGP动态路由将本地数据中心的数据转发至VBR：

-   静态路由

    示例：

    ```
      ip route 192.168.0.0/16 10.100.0.1
      ip route 192.168.0.0/16 10.100.1.1
    ```

-   动态路由

    您也可以通过配置BGP动态路由来转发本地数据中心与VBR之间的通信：

    1.  创建BGP组，详情参见[创建BGP组](intl.zh-CN/用户指南/BGP/管理BGP组.md#section_q2j_hz1_ydb)。
    2.  在BGP组中添加BGP邻居，详情参见[创建BGP邻居](intl.zh-CN/用户指南/BGP/管理BGP邻居.md#section_fxm_rbb_ydb)。
    3.  宣告BGP网段，详情参见[宣告BGP网段](intl.zh-CN/用户指南/BGP/宣告BGP网段.md#)。

        **说明：** 宣告网段为需要和本地数据中心通信的VPC的网段。本操作中为 192.168.0.0/16。


## 步骤八 验收测试 {#section_imb_zq1_ydb .section}

网络互通后，请测试物理专线速率，以确保满足业务需求。详细测速方式请参考文档[物理专线网络性能测试](../../../../intl.zh-CN/最佳实践/物理专线网络性能测试方法.md#)。

